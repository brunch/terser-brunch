// Generated by CoffeeScript 1.6.2
var UglifyMinifier, sysPath, uglify,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

sysPath = require('path');

uglify = require('uglify-js');

module.exports = UglifyMinifier = (function() {
  UglifyMinifier.prototype.brunchPlugin = true;

  UglifyMinifier.prototype.type = 'javascript';

  function UglifyMinifier(config) {
    var key, value, _ref, _ref1, _ref2;

    this.config = config;
    this.optimize = __bind(this.optimize, this);
    this.options = {
      fromString: true
    };
    if (typeof ((_ref = this.config) != null ? (_ref1 = _ref.plugins) != null ? _ref1.uglify : void 0 : void 0) === 'object') {
      _ref2 = this.config.plugins.uglify;
      for (key in _ref2) {
        value = _ref2[key];
        if (!(typeof value === 'object' && Object.isFrozen(value))) {
          this.options[key] = value;
        }
      }
    }
  }

  UglifyMinifier.prototype.optimize = function(data, path, callback) {
    var err, error, optimized;

    try {
      optimized = uglify.minify(data, this.options).code;
    } catch (_error) {
      err = _error;
      error = "JS minify failed on " + path + ": " + err;
    }
    return process.nextTick(function() {
      return callback(error, optimized || data);
    });
  };

  return UglifyMinifier;

})();
